<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FF9900">
    <title>WHS Safety Audit - Amazon Austria</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* App Header */
        .app-header {
            background-color: #232f3e;
            color: white;
            padding: 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 18px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-icon {
            cursor: pointer;
            padding: 5px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-item:active {
            background-color: #f0f0f0;
        }

        .nav-item.active {
            color: #FF9900;
        }

        .nav-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 2px;
        }

        .nav-label {
            font-size: 11px;
        }

        /* Main Content */
        .main-content {
            padding-top: 70px;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        /* Screen Container */
        .screen {
            display: none;
            padding: 15px;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo img {
            width: 120px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #FF9900;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background-color: #FF9900;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:active {
            background-color: #e88b00;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-success {
            background-color: #28a745;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dashboard-card:active {
            transform: scale(0.98);
        }

        .dashboard-card-icon {
            font-size: 48px;
            color: #FF9900;
            margin-bottom: 10px;
        }

        .dashboard-card-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .dashboard-card-value {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            margin-top: 5px;
        }

        /* Audit List */
        .audit-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .audit-item:active {
            transform: scale(0.98);
        }

        .audit-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .audit-title {
            font-weight: 500;
            color: #333;
        }

        .audit-score {
            font-size: 20px;
            font-weight: bold;
            color: #FF9900;
        }

        .audit-details {
            font-size: 14px;
            color: #666;
        }

        /* New Audit Form */
        .audit-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Question Screen */
        .question-progress {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: #FF9900;
            height: 100%;
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .question-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 400px;
            position: relative;
        }

        .question-section {
            font-size: 14px;
            color: #FF9900;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .question-number {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-id {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .critical-badge {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .question-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .question-basis {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-bottom: 20px;
        }

        .answer-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .answer-btn {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .answer-btn:active {
            transform: scale(0.95);
        }

        .answer-btn.yes {
            color: #28a745;
            border-color: #28a745;
        }

        .answer-btn.yes.selected {
            background: #28a745;
            color: white;
        }

        .answer-btn.no {
            color: #dc3545;
            border-color: #dc3545;
        }

        .answer-btn.no.selected {
            background: #dc3545;
            color: white;
        }

        .answer-btn.na {
            color: #6c757d;
            border-color: #6c757d;
        }

        .answer-btn.na.selected {
            background: #6c757d;
            color: white;
        }

        .comment-section {
            margin-top: 20px;
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 60px;
            font-size: 14px;
        }

        .photo-section {
            margin-top: 15px;
        }

        .photo-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
        }

        .photo-preview {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .photo-thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* Summary Screen */
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .summary-score {
            font-size: 48px;
            font-weight: bold;
            color: #FF9900;
        }

        .summary-status {
            font-size: 18px;
            color: #666;
            margin-top: 10px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .stat-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 500;
        }

        .modal-close {
            cursor: pointer;
            padding: 5px;
        }

        /* Offline indicator */
        .offline-indicator {
            background: #ffc107;
            color: #333;
            padding: 5px 10px;
            text-align: center;
            font-size: 14px;
            display: none;
        }

        body.offline .offline-indicator {
            display: block;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #FF9900;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch feedback */
        .touchable {
            position: relative;
            overflow: hidden;
        }

        .touchable::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0,0,0,0.1);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .touchable:active::after {
            width: 100%;
            height: 100%;
        }

        /* Swipe hint */
        .swipe-hint {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* File input hidden */
        input[type="file"] {
            display: none;
        }

        /* Error/Success messages */
        .message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .message.error {
            background: #fee;
            color: #c33;
        }

        .message.success {
            background: #efe;
            color: #3c3;
        }
    </style>
</head>
<body>
    <!-- Offline Indicator -->
    <div class="offline-indicator">
        <span class="material-icons" style="vertical-align: middle; font-size: 16px;">cloud_off</span>
        Offline Modus - Daten werden lokal gespeichert
    </div>

    <!-- App Header -->
    <div class="app-header" id="appHeader">
        <div class="header-content">
            <div class="header-title">WHS Safety Audit</div>
            <div class="header-actions">
                <span class="material-icons header-icon" onclick="syncData()">sync</span>
                <span class="material-icons header-icon" onclick="showUserMenu()">account_circle</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="login-logo">
                    <h2>Amazon WHS Austria</h2>
                    <p style="color: #666; margin-top: 10px;">Safety Audit System</p>
                </div>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Benutzername</label>
                        <input type="text" class="form-input" id="username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passwort</label>
                        <input type="password" class="form-input" id="password" required>
                    </div>
                    <button type="submit" class="btn">Anmelden</button>
                </form>
                <div id="loginError"></div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboardScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Dashboard</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="showScreen('newAuditScreen')">
                    <span class="material-icons dashboard-card-icon">add_circle</span>
                    <div class="dashboard-card-title">Neues Audit</div>
                </div>
                <div class="dashboard-card">
                    <span class="material-icons dashboard-card-icon">today</span>
                    <div class="dashboard-card-title">Heute</div>
                    <div class="dashboard-card-value" id="todayCount">0</div>
                </div>
                <div class="dashboard-card">
                    <span class="material-icons dashboard-card-icon">assessment</span>
                    <div class="dashboard-card-title">Ø Score</div>
                    <div class="dashboard-card-value" id="avgScore">0%</div>
                </div>
                <div class="dashboard-card">
                    <span class="material-icons dashboard-card-icon">warning</span>
                    <div class="dashboard-card-title">Kritisch</div>
                    <div class="dashboard-card-value" id="criticalCount">0</div>
                </div>
            </div>
            
            <h3 style="margin: 20px 0 10px;">Letzte Audits</h3>
            <div id="recentAudits"></div>
        </div>

        <!-- Audits List Screen -->
        <div id="auditsScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Alle Audits</h2>
            <div id="auditsList"></div>
        </div>

        <!-- New Audit Screen -->
        <div id="newAuditScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Neues Audit</h2>
            <div class="audit-form">
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <select class="form-input" id="auditLocation">
                        <option value="DVI1">DVI1</option>
                        <option value="DVI2">DVI2</option>
                        <option value="DVI3">DVI3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Bereich</label>
                    <input type="text" class="form-input" id="auditArea" placeholder="z.B. Versand, Wareneingang">
                </div>
                <div class="form-group">
                    <label class="form-label">Schicht</label>
                    <select class="form-input" id="auditShift">
                        <option value="Frühschicht">Frühschicht</option>
                        <option value="Spätschicht">Spätschicht</option>
                        <option value="Nachtschicht">Nachtschicht</option>
                    </select>
                </div>
                <button class="btn" onclick="startNewAudit()">Audit starten</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="questionScreen" class="screen">
            <div class="question-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 von 0 Fragen</div>
            </div>

            <div class="question-container" id="questionContainer">
                <!-- Question content will be dynamically inserted here -->
            </div>

            <div class="navigation-buttons">
                <button class="nav-btn btn-secondary" onclick="previousQuestion()">
                    <span class="material-icons">arrow_back</span>
                    Zurück
                </button>
                <button class="nav-btn btn" onclick="nextQuestion()">
                    Weiter
                    <span class="material-icons">arrow_forward</span>
                </button>
            </div>

            <div class="swipe-hint">
                <span class="material-icons">swipe</span>
                Wischen für nächste Frage
            </div>
        </div>

        <!-- Summary Screen -->
        <div id="summaryScreen" class="screen">
            <div class="summary-card">
                <div class="summary-header">
                    <h2>Audit Abgeschlossen</h2>
                    <div class="summary-score" id="summaryScore">0%</div>
                    <div class="summary-status" id="summaryStatus">Status</div>
                </div>
                
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="statPassed">0</div>
                        <div class="stat-label">Bestanden</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statFailed">0</div>
                        <div class="stat-label">Nicht bestanden</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statCritical">0</div>
                        <div class="stat-label">Kritisch</div>
                    </div>
                </div>

                <div id="criticalIssues"></div>

                <button class="btn" onclick="finishAudit()">PDF generieren & Beenden</button>
                <button class="btn btn-secondary" style="margin-top: 10px;" onclick="showScreen('dashboardScreen')">Zum Dashboard</button>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settingsScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Einstellungen</h2>
            
            <div class="summary-card">
                <h3>Daten Export/Import</h3>
                <button class="btn" onclick="exportQuestions()" style="margin-bottom: 10px;">Fragen exportieren (JSON)</button>
                <button class="btn" onclick="exportAllAudits()">Alle Audits exportieren (ZIP)</button>
                
                <div style="margin-top: 20px;">
                    <label class="btn btn-secondary" for="importFile">
                        Fragen importieren
                        <input type="file" id="importFile" accept=".json" onchange="importQuestions(event)">
                    </label>
                </div>
            </div>

            <div class="summary-card" id="adminSection" style="display: none;">
                <h3>Benutzerverwaltung</h3>
                <button class="btn" onclick="showUserManagement()">Benutzer verwalten</button>
            </div>

            <div class="summary-card">
                <h3>Account</h3>
                <p style="margin-bottom: 10px;" id="currentUserInfo"></p>
                <button class="btn btn-danger" onclick="logout()">Abmelden</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <div class="nav-item active" onclick="showScreen('dashboardScreen')">
            <span class="material-icons nav-icon">dashboard</span>
            <span class="nav-label">Dashboard</span>
        </div>
        <div class="nav-item" onclick="showScreen('auditsScreen')">
            <span class="material-icons nav-icon">list</span>
            <span class="nav-label">Audits</span>
        </div>
        <div class="nav-item" onclick="showScreen('newAuditScreen')">
            <span class="material-icons nav-icon">add_circle</span>
            <span class="nav-label">Neu</span>
        </div>
        <div class="nav-item" onclick="showScreen('settingsScreen')">
            <span class="material-icons nav-icon">settings</span>
            <span class="nav-label">Mehr</span>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Benutzerverwaltung</h3>
                <span class="material-icons modal-close" onclick="closeModal('userModal')">close</span>
            </div>
            <div id="userModalContent"></div>
        </div>
    </div>

    <script>
        // Audit Questions Data
        const auditQuestions = {
            "1": {
                "title": "ALLGEMEINE SICHERHEIT",
                "subsections": {
                    "Notfallausstattung": [
                        {
                            "id": "1.1",
                            "question": "Sind Sicherheitshinweise und Fluchtwegpläne deutlich sichtbar?",
                            "critical": true,
                            "basis": "AStV § 19"
                        },
                        {
                            "id": "1.2",
                            "question": "Sind alle Notausgänge frei und gut gekennzeichnet?",
                            "critical": true,
                            "basis": "AStV § 20"
                        },
                        {
                            "id": "1.3",
                            "question": "Ist die Erste-Hilfe-Ausstattung vollständig und erreichbar?",
                            "critical": true,
                            "basis": "ASchG § 26"
                        },
                        {
                            "id": "1.4",
                            "question": "Ist die Notfallausrüstung (Augenspülung, Feuerlöscher) zugänglich?",
                            "critical": true,
                            "basis": null
                        }
                    ],
                    "Persönliche Schutzausrüstung": [
                        {
                            "id": "1.5",
                            "question": "Tragen alle Mitarbeiter die korrekte PSA?",
                            "critical": false,
                            "basis": "ASchG § 71"
                        },
                        {
                            "id": "1.6",
                            "question": "Sind alle Mitarbeiter-Badges sichtbar?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "1.7",
                            "question": "Entsprechen Frisur/Kleidung den Sicherheitsvorschriften? (max. Schulterhöhe)",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "1.8",
                            "question": "Sind aktuelle Arbeitsanweisungen verfügbar?",
                            "critical": false,
                            "basis": "ASchG § 12"
                        }
                    ]
                }
            },
            "2": {
                "title": "ARBEITSPLATZ UND UMGEBUNG",
                "subsections": {
                    "Ordnung und Sauberkeit": [
                        {
                            "id": "2.1",
                            "question": "Ist die Lagerhalle sauber und aufgeräumt?",
                            "critical": false,
                            "basis": "AStV § 4"
                        },
                        {
                            "id": "2.2",
                            "question": "Sind die Böden rutschfest und eben?",
                            "critical": true,
                            "basis": "AStV § 5"
                        },
                        {
                            "id": "2.3",
                            "question": "Ist ausreichend Bewegungsfreiheit vorhanden? (min. 1,5 m² pro Person)",
                            "critical": false,
                            "basis": null
                        }
                    ],
                    "Arbeitsumgebung": [
                        {
                            "id": "2.4",
                            "question": "Entspricht die Beleuchtung den Anforderungen? (min. 200 Lux)",
                            "critical": false,
                            "basis": "AStV § 22"
                        },
                        {
                            "id": "2.5",
                            "question": "Ist die Raumtemperatur angemessen? (18-25°C)",
                            "critical": false,
                            "basis": "AStV § 23"
                        },
                        {
                            "id": "2.6",
                            "question": "Ist die Lüftung ausreichend?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "2.7",
                            "question": "Liegt der Lärmpegel im zulässigen Bereich? (≤ 85 dB(A))",
                            "critical": false,
                            "basis": null
                        }
                    ],
                    "Ergonomie": [
                        {
                            "id": "2.8",
                            "question": "Sind die Arbeitsplätze ergonomisch gestaltet?",
                            "critical": false,
                            "basis": "AStV § 21"
                        }
                    ]
                }
            },
            "3": {
                "title": "LAGERUNG UND TRANSPORT",
                "subsections": {
                    "Lagerbereiche": [
                        {
                            "id": "3.1",
                            "question": "Werden die 5S-Markierungen respektiert?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.2",
                            "question": "Sind die Lagerbereiche sicher organisiert?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.3",
                            "question": "Werden Lagerungen über Kopf vermieden?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.4",
                            "question": "Sind Regale ordnungsgemäß befestigt?",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "3.5",
                            "question": "Sind die maximalen Stapelhöhen eingehalten?",
                            "critical": false,
                            "basis": null
                        }
                    ],
                    "Transportwege": [
                        {
                            "id": "3.6",
                            "question": "Sind Fußgängerwege klar gekennzeichnet? (min. 1,2 m breit)",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.7",
                            "question": "Sind alle Transportwege frei von Hindernissen?",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "3.8",
                            "question": "Sind Gefahrenbereiche deutlich markiert?",
                            "critical": false,
                            "basis": null
                        }
                    ],
                    "Flurförderzeuge": [
                        {
                            "id": "3.9",
                            "question": "Sind alle Flurförderzeuge in gutem Zustand?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.10",
                            "question": "Sind die Wartungsprotokolle aktuell? (jährliche Prüfung)",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "3.11",
                            "question": "Sind Ladehilfsmittel unbeschädigt?",
                            "critical": false,
                            "basis": null
                        }
                    ]
                }
            },
            "4": {
                "title": "GEFAHRSTOFFE",
                "subsections": {
                    "": [
                        {
                            "id": "4.1",
                            "question": "Sind Gefahrstoffe korrekt gelagert?",
                            "critical": true,
                            "basis": "ChemG"
                        },
                        {
                            "id": "4.2",
                            "question": "Sind alle Gefahrstoffe ordnungsgemäß gekennzeichnet?",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "4.3",
                            "question": "Sind Sicherheitsdatenblätter verfügbar?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "4.4",
                            "question": "Sind Gefahrstoffbereiche abgesperrt?",
                            "critical": true,
                            "basis": null
                        }
                    ]
                }
            },
            "5": {
                "title": "ERGONOMIE UND ARBEITSVERHALTEN",
                "subsections": {
                    "": [
                        {
                            "id": "5.1",
                            "question": "Vermeiden Mitarbeiter ungünstige Körperhaltungen?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "5.2",
                            "question": "Werden Transportwagen kontrolliert bewegt?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "5.3",
                            "question": "Werden Handläufe verwendet (wo vorhanden)?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "5.4",
                            "question": "Werden Hebehilfen bei schweren Lasten eingesetzt? (ab 25 kg Männer, 15 kg Frauen)",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "5.5",
                            "question": "Werden Pausenzeiten eingehalten?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "5.6",
                            "question": "Ist der Arbeitsrhythmus angemessen?",
                            "critical": false,
                            "basis": null
                        }
                    ]
                }
            },
            "6": {
                "title": "NOTFALLVORSORGE",
                "subsections": {
                    "Personal": [
                        {
                            "id": "6.1",
                            "question": "Sind genügend Ersthelfer verfügbar? (1 pro 19 Mitarbeiter)",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "6.2",
                            "question": "Sind Brandschutzwarte ernannt und geschult?",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "6.3",
                            "question": "Sind die Notfallpläne aktuell und bekannt?",
                            "critical": false,
                            "basis": null
                        }
                    ],
                    "Übungen": [
                        {
                            "id": "6.4",
                            "question": "Werden regelmäßig Notfallübungen durchgeführt?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "6.5",
                            "question": "Sind Sammelplätze bekannt und gekennzeichnet?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "6.6",
                            "question": "Funktioniert das Alarmsystem ordnungsgemäß?",
                            "critical": true,
                            "basis": null
                        }
                    ]
                }
            },
            "7": {
                "title": "WARTUNG UND INSTANDHALTUNG",
                "subsections": {
                    "": [
                        {
                            "id": "7.1",
                            "question": "Werden Wartungsintervalle bei Toren eingehalten?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "7.2",
                            "question": "Sind Feuerlöscher-Prüffristen aktuell? (alle 2 Jahre)",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "7.3",
                            "question": "Sind elektrische Anlagen ordnungsgemäß geprüft?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "7.4",
                            "question": "Erfolgt regelmäßige Wartung der Lüftungsanlagen?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "7.5",
                            "question": "Sind alle Wartungsprotokolle verfügbar?",
                            "critical": false,
                            "basis": null
                        }
                    ]
                }
            },
            "8": {
                "title": "HÖHENARBEITEN (falls zutreffend)",
                "subsections": {
                    "": [
                        {
                            "id": "8.1",
                            "question": "Sind Absturzsicherungen vorhanden?",
                            "critical": true,
                            "basis": null
                        },
                        {
                            "id": "8.2",
                            "question": "Ist spezielle Schutzausrüstung verfügbar?",
                            "critical": false,
                            "basis": null
                        },
                        {
                            "id": "8.3",
                            "question": "Sind Arbeiten in der Höhe genehmigt?",
                            "critical": false,
                            "basis": null
                        }
                    ]
                }
            }
        };

        // Global variables
        let currentUser = null;
        let currentAudit = null;
        let currentQuestionIndex = 0;
        let allQuestions = [];

        // Initialize app
        function initApp() {
            // Initialize default users if not exists
            if (!localStorage.getItem('users')) {
                const defaultUsers = [
                    { username: 'admin', password: 'admin123', role: 'admin' },
                    { username: 'user', password: 'user123', role: 'user' }
                ];
                localStorage.setItem('users', JSON.stringify(defaultUsers));
            }

            // Initialize audit questions if not exists
            if (!localStorage.getItem('auditQuestions')) {
                localStorage.setItem('auditQuestions', JSON.stringify(auditQuestions));
            }

            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }

            // Setup offline detection
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();

            // Setup swipe gestures for question navigation
            setupSwipeGestures();
        }

        // Login handling
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = JSON.parse(localStorage.getItem('users'));
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainApp();
            } else {
                showMessage('loginError', 'Ungültige Anmeldedaten', 'error');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showScreen('loginScreen');
            document.getElementById('bottomNav').style.display = 'none';
            document.getElementById('appHeader').style.display = 'none';
        }

        // Show main app after login
        function showMainApp() {
            document.getElementById('bottomNav').style.display = 'flex';
            document.getElementById('appHeader').style.display = 'block';
            
            // Update user info
            document.getElementById('currentUserInfo').textContent = `Angemeldet als: ${currentUser.username} (${currentUser.role})`;
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminSection').style.display = 'block';
            }
            
            updateDashboard();
            showScreen('dashboardScreen');
        }

        // Screen navigation
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Highlight active nav item
            const navMap = {
                'dashboardScreen': 0,
                'auditsScreen': 1,
                'newAuditScreen': 2,
                'settingsScreen': 3
            };
            
            if (navMap[screenId] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[screenId]].classList.add('active');
            }
            
            // Load data for specific screens
            if (screenId === 'auditsScreen') {
                loadAuditsList();
            } else if (screenId === 'dashboardScreen') {
                updateDashboard();
            }
        }

        // Dashboard functions
        function updateDashboard() {
            const audits = JSON.parse(localStorage.getItem('audits') || '[]');
            const today = new Date().toDateString();
            const todayAudits = audits.filter(a => new Date(a.date).toDateString() === today);
            
            document.getElementById('todayCount').textContent = todayAudits.length;
            
            if (audits.length > 0) {
                const totalScore = audits.reduce((sum, audit) => sum + audit.score, 0);
                const avgScore = Math.round(totalScore / audits.length);
                document.getElementById('avgScore').textContent = avgScore + '%';
                
                const totalCritical = audits.reduce((sum, audit) => sum + audit.criticalFailures, 0);
                document.getElementById('criticalCount').textContent = totalCritical;
            }
            
            // Show recent audits
            const recentAudits = audits.slice(-3).reverse();
            const recentContainer = document.getElementById('recentAudits');
            recentContainer.innerHTML = '';
            
            recentAudits.forEach(audit => {
                const auditElement = createAuditListItem(audit);
                recentContainer.appendChild(auditElement);
            });
        }

        // Audit list functions
        function loadAuditsList() {
            const audits = JSON.parse(localStorage.getItem('audits') || '[]');
            const container = document.getElementById('auditsList');
            container.innerHTML = '';
            
            if (audits.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Keine Audits vorhanden</p>';
                return;
            }
            
            audits.reverse().forEach(audit => {
                const auditElement = createAuditListItem(audit);
                container.appendChild(auditElement);
            });
        }

        function createAuditListItem(audit) {
            const div = document.createElement('div');
            div.className = 'audit-item';
            div.onclick = () => viewAudit(audit.id);
            
            div.innerHTML = `
                <div class="audit-header">
                    <div class="audit-title">${audit.location} - ${audit.area || 'N/A'}</div>
                    <div class="audit-score">${audit.score}%</div>
                </div>
                <div class="audit-details">
                    ${new Date(audit.date).toLocaleDateString('de-AT')} ${new Date(audit.date).toLocaleTimeString('de-AT', {hour: '2-digit', minute:'2-digit'})}<br>
                    ${audit.shift} | ${audit.auditor}
                </div>
            `;
            
            return div;
        }

        // New audit functions
        function startNewAudit() {
            const location = document.getElementById('auditLocation').value;
            const area = document.getElementById('auditArea').value;
            const shift = document.getElementById('auditShift').value;
            
            // Prepare questions
            prepareQuestions();
            
            currentAudit = {
                id: Date.now(),
                date: new Date().toISOString(),
                location: location,
                area: area || 'N/A',
                shift: shift,
                auditor: currentUser.username,
                answers: {},
                comments: {},
                photos: {},
                status: 'in_progress'
            };
            
            currentQuestionIndex = 0;
            showQuestion();
            showScreen('questionScreen');
        }

        function prepareQuestions() {
            allQuestions = [];
            const questions = JSON.parse(localStorage.getItem('auditQuestions'));
            
            Object.keys(questions).forEach(sectionKey => {
                const section = questions[sectionKey];
                Object.keys(section.subsections).forEach(subsectionKey => {
                    section.subsections[subsectionKey].forEach(question => {
                        allQuestions.push({
                            ...question,
                            section: section.title,
                            subsection: subsectionKey
                        });
                    });
                });
            });
        }

        function showQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                showSummary();
                return;
            }
            
            const question = allQuestions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / allQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1} von ${allQuestions.length} Fragen`;
            
            // Build question HTML
            container.innerHTML = `
                <div class="question-section">${question.section}</div>
                ${question.subsection ? `<div style="color: #666; font-size: 14px; margin-bottom: 10px;">${question.subsection}</div>` : ''}
                <div class="question-number">
                    <span class="question-id">${question.id}</span>
                    ${question.critical ? '<span class="critical-badge">KRITISCH</span>' : ''}
                </div>
                <div class="question-text">${question.question}</div>
                ${question.basis ? `<div class="question-basis">Basis: ${question.basis}</div>` : ''}
                
                <div class="answer-buttons">
                    <button class="answer-btn yes ${currentAudit.answers[question.id] === 'YES' ? 'selected' : ''}" 
                            onclick="selectAnswer('YES')">JA</button>
                    <button class="answer-btn no ${currentAudit.answers[question.id] === 'NO' ? 'selected' : ''}" 
                            onclick="selectAnswer('NO')">NEIN</button>
                    <button class="answer-btn na ${currentAudit.answers[question.id] === 'NA' ? 'selected' : ''}" 
                            onclick="selectAnswer('NA')">N/A</button>
                </div>
                
                <div class="comment-section">
                    <label class="form-label" style="font-size: 14px;">Kommentar (optional)</label>
                    <textarea class="comment-input" 
                              placeholder="Zusätzliche Anmerkungen..."
                              onchange="saveComment(this.value)">${currentAudit.comments[question.id] || ''}</textarea>
                </div>
                
                <div class="photo-section">
                    <label class="photo-btn" for="photoInput">
                        <span class="material-icons">add_a_photo</span>
                        Foto hinzufügen
                        <input type="file" id="photoInput" accept="image/*" capture="environment" 
                               onchange="handlePhoto(event)">
                    </label>
                    <div class="photo-preview" id="photoPreview">
                        ${getPhotoPreview(question.id)}
                    </div>
                </div>
            `;
        }

        function selectAnswer(answer) {
            const question = allQuestions[currentQuestionIndex];
            currentAudit.answers[question.id] = answer;
            
            // Update button styling
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Auto-advance after short delay
            setTimeout(() => {
                nextQuestion();
            }, 300);
        }

        function saveComment(comment) {
            const question = allQuestions[currentQuestionIndex];
            if (comment.trim()) {
                currentAudit.comments[question.id] = comment;
            } else {
                delete currentAudit.comments[question.id];
            }
        }

        function handlePhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const question = allQuestions[currentQuestionIndex];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                if (!currentAudit.photos[question.id]) {
                    currentAudit.photos[question.id] = [];
                }
                currentAudit.photos[question.id].push({
                    data: e.target.result,
                    timestamp: new Date().toISOString()
                });
                
                // Update preview
                document.getElementById('photoPreview').innerHTML = getPhotoPreview(question.id);
            };
            
            reader.readAsDataURL(file);
        }

        function getPhotoPreview(questionId) {
            const photos = currentAudit.photos[questionId] || [];
            return photos.map((photo, index) => 
                `<img src="${photo.data}" class="photo-thumb" onclick="viewPhoto('${questionId}', ${index})">`
            ).join('');
        }

        function viewPhoto(questionId, index) {
            // Could implement a full-screen photo viewer here
            console.log('View photo:', questionId, index);
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < allQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showSummary();
            }
        }

        // Summary and completion
        function showSummary() {
            // Calculate results
            let passed = 0;
            let failed = 0;
            let criticalFailures = 0;
            let criticalIssues = [];
            
            allQuestions.forEach(question => {
                const answer = currentAudit.answers[question.id];
                if (answer === 'YES') {
                    passed++;
                } else if (answer === 'NO') {
                    failed++;
                    if (question.critical) {
                        criticalFailures++;
                        criticalIssues.push({
                            id: question.id,
                            question: question.question
                        });
                    }
                }
            });
            
            const totalAnswered = passed + failed;
            const score = totalAnswered > 0 ? Math.round((passed / totalAnswered) * 100) : 0;
            
            // Update audit object
            currentAudit.score = score;
            currentAudit.itemsPassed = passed;
            currentAudit.itemsFailed = failed;
            currentAudit.totalItems = allQuestions.length;
            currentAudit.criticalFailures = criticalFailures;
            currentAudit.status = 'completed';
            
            // Update summary UI
            document.getElementById('summaryScore').textContent = score + '%';
            document.getElementById('summaryStatus').textContent = 
                criticalFailures === 0 ? 'Keine kritischen Mängel' : `${criticalFailures} kritische Mängel`;
            document.getElementById('statPassed').textContent = passed;
            document.getElementById('statFailed').textContent = failed;
            document.getElementById('statCritical').textContent = criticalFailures;
            
            // Show critical issues
            const criticalContainer = document.getElementById('criticalIssues');
            if (criticalIssues.length > 0) {
                criticalContainer.innerHTML = '<h3 style="margin-top: 20px;">Kritische Mängel:</h3>';
                criticalIssues.forEach(issue => {
                    criticalContainer.innerHTML += `
                        <div style="background: #fee; padding: 10px; margin: 5px 0; border-radius: 5px;">
                            <strong>${issue.id}:</strong> ${issue.question}
                        </div>
                    `;
                });
            } else {
                criticalContainer.innerHTML = '';
            }
            
            showScreen('summaryScreen');
        }

        function finishAudit() {
            // Save audit
            const audits = JSON.parse(localStorage.getItem('audits') || '[]');
            audits.push(currentAudit);
            localStorage.setItem('audits', JSON.stringify(audits));
            
            // Generate PDF
            generatePDF(currentAudit);
            
            // Reset
            currentAudit = null;
            currentQuestionIndex = 0;
            allQuestions = [];
            
            // Clear form
            document.getElementById('auditArea').value = '';
            
            updateDashboard();
            showScreen('dashboardScreen');
        }

        // PDF Generation
        function generatePDF(audit) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.text('AMAZON AUSTRIA', 20, 20);
            doc.setFontSize(16);
            doc.text('Workplace Health & Safety', 20, 30);
            doc.setFontSize(18);
            doc.text('SAFETY AUDIT REPORT', 20, 40);
            
            // Audit Information
            doc.setFontSize(12);
            doc.text('AUDIT INFORMATION', 20, 60);
            doc.setFontSize(10);
            doc.text(`Date/Time: ${new Date(audit.date).toLocaleDateString('de-AT')} ${new Date(audit.date).toLocaleTimeString('de-AT')}`, 20, 70);
            doc.text(`Location: ${audit.location}`, 20, 75);
            doc.text(`Area: ${audit.area}`, 20, 80);
            doc.text(`Shift: ${audit.shift}`, 20, 85);
            doc.text(`Auditor: ${audit.auditor}`, 20, 90);
            doc.text(`Status: ${audit.status}`, 20, 95);
            
            // Score Summary
            doc.setFontSize(12);
            doc.text('AUDIT SCORE SUMMARY', 20, 110);
            doc.setFontSize(10);
            doc.text(`Overall Score: ${audit.score}%`, 20, 120);
            doc.text(`Items Passed: ${audit.itemsPassed}/${audit.totalItems}`, 20, 125);
            doc.text(`Critical Failures: ${audit.criticalFailures}`, 20, 130);
            
            // Add new page for detailed results
            doc.addPage();
            doc.setFontSize(14);
            doc.text('DETAILED AUDIT RESULTS', 20, 20);
            
            let yPos = 40;
            const questions = JSON.parse(localStorage.getItem('auditQuestions'));
            
            Object.keys(questions).forEach(sectionKey => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                const section = questions[sectionKey];
                doc.setFontSize(12);
                doc.text(`${sectionKey}. ${section.title}`, 20, yPos);
                yPos += 10;
                
                Object.values(section.subsections).forEach(subsection => {
                    subsection.forEach(question => {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        const answer = audit.answers[question.id] || 'NO RESPONSE';
                        doc.setFontSize(10);
                        doc.text(`${question.id}: ${answer} ${question.critical ? '[CRITICAL]' : ''}`, 20, yPos);
                        yPos += 5;
                        
                        // Add question text
                        const lines = doc.splitTextToSize(question.question, 160);
                        lines.forEach(line => {
                            doc.text(line, 25, yPos);
                            yPos += 5;
                        });
                        
                        // Add comment if exists
                        if (audit.comments[question.id]) {
                            doc.setFontSize(8);
                            doc.text('Kommentar: ' + audit.comments[question.id], 25, yPos);
                            yPos += 5;
                        }
                        
                        yPos += 5;
                    });
                });
            });
            
            // Save PDF
            doc.save(`audit_${audit.location}_${new Date(audit.date).toISOString().split('T')[0]}.pdf`);
        }

        // View audit
        function viewAudit(auditId) {
            const audits = JSON.parse(localStorage.getItem('audits') || '[]');
            const audit = audits.find(a => a.id === auditId);
            if (audit) {
                generatePDF(audit);
            }
        }

        // Export/Import functions
        function exportQuestions() {
            const questions = localStorage.getItem('auditQuestions');
            const blob = new Blob([questions], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'audit_questions.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importQuestions(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const questions = JSON.parse(e.target.result);
                    localStorage.setItem('auditQuestions', JSON.stringify(questions));
                    alert('Fragen erfolgreich importiert!');
                } catch (error) {
                    alert('Fehler beim Importieren der Datei!');
                }
            };
            reader.readAsText(file);
        }

        function exportAllAudits() {
            const audits = JSON.parse(localStorage.getItem('audits') || '[]');
            const zip = new JSZip();
            
            // Add JSON data
            zip.file('audits_data.json', JSON.stringify(audits, null, 2));
            
            // Generate ZIP
            zip.generateAsync({ type: 'blob' }).then(function(content) {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `audits_export_${new Date().toISOString().split('T')[0]}.zip`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        // User management
        function showUserMenu() {
            // Could implement a user menu modal here
            console.log('Show user menu');
        }

        function showUserManagement() {
            const modal = document.getElementById('userModal');
            const content = document.getElementById('userModalContent');
            
            const users = JSON.parse(localStorage.getItem('users'));
            
            content.innerHTML = `
                <div class="form-group">
                    <h4>Neuer Benutzer</h4>
                    <input type="text" class="form-input" id="newUsername" placeholder="Benutzername">
                    <input type="password" class="form-input" id="newPassword" placeholder="Passwort" style="margin-top: 10px;">
                    <select class="form-input" id="newRole" style="margin-top: 10px;">
                        <option value="user">Benutzer</option>
                        <option value="admin">Administrator</option>
                    </select>
                    <button class="btn" onclick="addUser()" style="margin-top: 10px;">Hinzufügen</button>
                </div>
                <h4 style="margin-top: 20px;">Bestehende Benutzer</h4>
            `;
            
            users.forEach(user => {
                if (user.username !== 'admin') {
                    content.innerHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f5f5f5; margin: 5px 0; border-radius: 5px;">
                            <span>${user.username} (${user.role})</span>
                            <button class="btn btn-danger" onclick="deleteUser('${user.username}')" style="padding: 5px 10px;">Löschen</button>
                        </div>
                    `;
                }
            });
            
            modal.classList.add('active');
        }

        function addUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;
            
            if (!username || !password) {
                alert('Bitte alle Felder ausfüllen');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            
            if (users.find(u => u.username === username)) {
                alert('Benutzername existiert bereits!');
                return;
            }
            
            users.push({ username, password, role });
            localStorage.setItem('users', JSON.stringify(users));
            
            showUserManagement(); // Refresh list
        }

        function deleteUser(username) {
            if (confirm(`Benutzer ${username} wirklich löschen?`)) {
                const users = JSON.parse(localStorage.getItem('users'));
                const filteredUsers = users.filter(u => u.username !== username);
                localStorage.setItem('users', JSON.stringify(filteredUsers));
                
                showUserManagement(); // Refresh list
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Utility functions
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 3000);
        }

        function updateOnlineStatus() {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
            } else {
                document.body.classList.add('offline');
            }
        }

        function syncData() {
            if (!navigator.onLine) {
                alert('Keine Internetverbindung. Daten werden lokal gespeichert.');
                return;
            }
            
            // Here you would implement actual sync with server
            alert('Sync-Funktion wird in zukünftiger Version implementiert');
        }

        // Swipe gestures
        function setupSwipeGestures() {
            const questionContainer = document.getElementById('questionContainer');
            const hammer = new Hammer(questionContainer);
            
            hammer.on('swipeleft', function() {
                if (document.getElementById('questionScreen').classList.contains('active')) {
                    nextQuestion();
                }
            });
            
            hammer.on('swiperight', function() {
                if (document.getElementById('questionScreen').classList.contains('active')) {
                    previousQuestion();
                }
            });
        }

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
